{%- set tplroot = tpldir.split('/')[0] %}
{% import_yaml tplroot+"/defaults.yaml" as defaults %}

{% set consulbootstrap = salt['pillar.get']('consulbootstrap', default=defaults.consul, merge=True) %}

{# Add any overrides based on CPU architecture. #}
{% set consulbootstrap = salt['grains.filter_by']({
        'armv6l': {
            "arch": 'arm'
        },
        'armv7l': {
            "arch": 'arm'
        },
        'x86_64': {
            "arch": 'amd64'
        }
  }
  ,grain="cpuarch"
  ,merge=consulbootstrap)
%}

{% do consulbootstrap.config.update({'retry_join': consulbootstrap.config.retry_join or []}) %}
